# ๐ ุงููุธุงู ุงููุญุณูู ูุชุฏููู ุฌูุงุฆุฒ ุณุจุงูุงุช ุงููุฌู

## Enhanced Camel Awards Audit System

[![Status](https://img.shields.io/badge/Status-Production%20Ready-success)]()
[![Version](https://img.shields.io/badge/Version-2.0-blue)]()
[![Python](https://img.shields.io/badge/Python-3.8%2B-blue)]()

---

## ๐ ูุธุฑุฉ ุนุงูุฉ

ูุธุงู ุชุฏููู ุงุญุชุฑุงูู ูุชูุงูู ููุดู ุงูุตุฑู ุงูููุฑุฑ ูู ุฌูุงุฆุฒ ุณุจุงูุงุช ุงููุฌูุ ูุน ูุทุงุจูุฉ ุจูููุฉ ุฏูููุฉ ูุชูุงุฑูุฑ ุดุงููุฉ.

### โจ ุงููููุฒุงุช ุงูุฑุฆูุณูุฉ

- โ **ุชูุญูุฏ ุงูุจูุงูุงุช ุงูุฐูู**: ุฎุฑูุทุฉ ุดุงููุฉ ูุชูุญูุฏ ุฃุณูุงุก ุงูุฃุนูุฏุฉ
- โ **ูุดู ุงูุชูุฑุงุฑุงุช ุจุฏูุฉ 100%**: ุจุงุณุชุฎุฏุงู ููุชุงุญ ูุฑูุจ ูู 6 ุญููู
- โ **ูุทุงุจูุฉ ุจูููุฉ ูุชูุฏูุฉ**: ุชุตููู ุซูุงุซู (Matched / Partial / Unmatched)
- โ **ุงูุชุญูู ูู ุงูุญุงูุงุช ุงููุนุฑููุฉ**: 28 ุญุงูุฉ ูุนุฑููุฉ ูุณุจูุงู
- โ **ุชูุงุฑูุฑ Excel ุงุญุชุฑุงููุฉ**: 3 ุชูุงุฑูุฑ ุดุงููุฉ ุฌุงูุฒุฉ ููุชุฏููู
- โ **ูุงุจู ูุฅุนุงุฏุฉ ุงูุงุณุชุฎุฏุงู**: ูููู ุชุทุจููู ุนูู ุฃู ุจูุงูุงุช ูุดุงุจูุฉ

---

## ๐ฏ ุงููุดููุฉ ุงูุชู ูุญููุง

### ุงููุดููุฉ:
ุตุฑู ุฌูุงุฆุฒ ุณุจุงูุงุช ุงููุฌู **ูุฑุชูู ุฃู ุฃูุซุฑ** ูููุณ:
- ุงููุงูู (Owner)
- ุงูุณุจุงู (Race)
- ุงูููุณู (Season)
- ุงููุจูุบ (Award Amount)

ููู ูู **ุชูุงุฑูุฎ ูุฎุชููุฉ** (Entry Date)

### ุงูุญู:
ุงุณุชุฎุฏุงู **ุงูููุชุงุญ ุงููุฑูุจ (Composite Key)**:

```
Season | Race | Owner Number | Owner Name | Owner QatariID | Award Amount
```

โ **ุชุทุงุจู ุชุงู** ูู ูุฐู ุงูุญููู ุงูู 6 = **ุตุฑู ููุฑุฑ**

โ๏ธ **Entry Date ูุง ูุฏุฎู** ูู ุงูููุชุงุญ - ุงุฎุชูุงูู ููุดู ุงูุชูุฑุงุฑ!

---

## ๐ฆ ุงูุชุซุจูุช

### ุงููุชุทูุจุงุช:
```bash
Python 3.8+
pandas
openpyxl
```

### ุงูุชุซุจูุช:
```powershell
# 1. ุงุณุชูุณุงุฎ ุงููุดุฑูุน
git clone <repository-url>
cd Data_Analest

# 2. ุชุซุจูุช ุงููุชุทูุจุงุช
pip install -r requirements.txt

# 3. ุงุฎุชุจุงุฑ ุงููุธุงู
python test_enhanced_system.py
```

---

## ๐ ุงูุงุณุชุฎุฏุงู ุงูุณุฑูุน

### ุงูุฎุทูุฉ 1: ุชุญุถูุฑ ุงููููุงุช

ุถุน ูููุงุชู ูู ูุฌูุฏ `uploads/`:

```
uploads/
โโโ Combined_Awards_2018_2025.xlsx   # ููู ุงูุฌูุงุฆุฒ (ูุฏููุฌ ุฃู ูุฑุฏู)
โโโ ุงูุนุฌูุฑู 11-4.csv                 # ูุดู ุงูุจูู
```

### ุงูุฎุทูุฉ 2: ุชุดุบูู ุงููุธุงู

```powershell
python run_enhanced_audit.py
```

### ุงูุฎุทูุฉ 3: ูุฑุงุฌุนุฉ ุงูุชูุงุฑูุฑ

ุณุชุฌุฏ ูู `outputs/`:

| ุงูุชูุฑูุฑ | ุงููุตู | ุงูุตูุญุงุช |
|---------|-------|---------|
| **Awards_Duplicates_[timestamp].xlsx** | ุชูุฑูุฑ ุงูุชูุฑุงุฑุงุช | AllRows, Summary, Data_Dictionary |
| **Bank_Match_Verification_[timestamp].xlsx** | ุชูุฑูุฑ ุงูุชุญูู ุงูุจููู | Matches, Partial, Unmatched, Notes |
| **Ground_Truth_Validation_[timestamp].xlsx** | ุชูุฑูุฑ ุงูุญุงูุงุช ุงููุนุฑููุฉ | Results, Summary |

---

## ๐ ุงูููููู ุงูุฃุณุงุณู: ุงูููุชุงุญ ุงููุฑูุจ

### ูุง ูู ุงูููุชุงุญ ุงููุฑูุจุ

ูู **ุฏูุฌ 6 ุญููู** ูุชูููู ูุนุฑูู ูุฑูุฏ:

```python
Key = Season + "|" + Race + "|" + OwnerNumber + "|" + 
      OwnerName + "|" + OwnerQatariID + "|" + AwardAmount
```

### ูุซุงู ุนููู:

#### โ **ุชูุฑุงุฑ (Duplicate):**

| Season | Race | Owner | QatariID | Amount | **EntryDate** |
|--------|------|-------|----------|--------|---------------|
| 2023-2024 | ุณุจุงู ุงูุฃุดูุงุท | ูุญูุฏ ุฃุญูุฏ | 28512345678 | 5000 | **2024-01-15** |
| 2023-2024 | ุณุจุงู ุงูุฃุดูุงุท | ูุญูุฏ ุฃุญูุฏ | 28512345678 | 5000 | **2024-03-20** |

**ุงููุชูุฌุฉ:** โ ุชูุฑุงุฑ (ููุณ ุงูููุชุงุญุ ููู ุชุงุฑูุฎูู ูุฎุชูููู)

#### โ **ููุณ ุชูุฑุงุฑุงู:**

| Season | Race | Owner | QatariID | Amount | EntryDate |
|--------|------|-------|----------|--------|-----------|
| 2023-2024 | ุณุจุงู ุงูุฃุดูุงุท | ูุญูุฏ ุฃุญูุฏ | 28512345678 | 5000 | 2024-01-15 |
| 2023-2024 | ุณุจุงู ุงูุฃุดูุงุท | ูุญูุฏ ุฃุญูุฏ | 28512345678 | **3000** | 2024-01-15 |

**ุงููุชูุฌุฉ:** โ ููุณ ุชูุฑุงุฑุงู (ุงููุจูุบ ูุฎุชูู)

---

## ๐ฆ ุงููุทุงุจูุฉ ุงูุจูููุฉ

### ููู ุชุนููุ

1. **ุงุณุชุฎุฑุงุฌ ุงููุฑุงุฌุน** ูู ุณุฌู ุงูุฌุงุฆุฒุฉ:
   - `PaymentReference`
   - `PaymentReference_D1` (ูููู 1)
   - `PaymentReference_D2` (ูููู 2)
   - `PaymentReference_D3` (ูููู 3)

2. **ุงูุจุญุซ ูู ูุดู ุงูุจูู**:
   - `Award Ref` (ุงููุฑุฌุน ุงููุงูู)
   - `Award Ref 10 Digits` (ุขุฎุฑ 10 ุฃุฑูุงู)

3. **ุงูุชุตููู**:

| ุงูุญุงูุฉ | ุงููุตู | ุงููุซุงู |
|--------|-------|---------|
| โ **MATCHED_100** | ูุฑุฌุน ูุทุงุจู + ูุจูุบ ูุทุงุจู | Ref: โ - Amount: 5000 = 5000 โ |
| โ๏ธ **PARTIAL** | ูุฑุฌุน ูุทุงุจู + ูุจูุบ ูุฎุชูู | Ref: โ - Amount: 5000 โ 4950 โ๏ธ |
| โ **UNMATCHED** | ูุง ููุฌุฏ ูุฑุฌุน ูุทุงุจู | Ref: โ |

---

## ๐ ููู ุงูุชูุงุฑูุฑ

### 1๏ธโฃ ุชูุฑูุฑ ุงูุชูุฑุงุฑุงุช

**Sheet 1: Duplicates_AllRows**
- ุฌููุน ุงูุตููู ุงูููุฑุฑุฉ ุจุงูุชูุตูู
- ุฃุนูุฏุฉ ุฑุฆูุณูุฉ:
  - `_DuplicateGroup`: ุฑูู ุงููุฌููุนุฉ
  - `_DuplicateCount`: ุนุฏุฏ ุงูุชูุฑุงุฑุงุช ูู ุงููุฌููุนุฉ
  - `PaymentReference`: ุงููุฑุฌุน ุงูุฑุฆูุณู
  - `ReasonText`: ุณุจุจ ุงูุชุตููู

**Sheet 2: Duplicates_Summary**
- ููุฎุต ุจูู ูุฌููุนุฉ:
  - ุนุฏุฏ ุงูุณุฌูุงุช
  - ุฅุฌูุงูู ุงููุจูุบ
  - ุฃูู/ุขุฎุฑ ุชุงุฑูุฎ

**Sheet 3: Data_Dictionary**
- ุฎุฑูุทุฉ ุงูุชูุญูุฏ ุงููุทุจูุฉ:
  - Original Name โ Unified Name

### 2๏ธโฃ ุชูุฑูุฑ ุงูุชุญูู ุงูุจููู

**Sheet 1: Bank_Matches**
- ุงูุณุฌูุงุช ุงููุทุงุจูุฉ 100%
- ุชูุงุตูู ุงูุชุญููู ุงูุจููู ูุงููุฉ

**Sheet 2: Bank_PartialOrSuspected**
- ุงูุญุงูุงุช ุงูุฌุฒุฆูุฉ/ุงููุดุชุจูุฉ
- ุณุจุจ ุงูุชุตููู

**Sheet 3: Bank_Unmatched**
- ุงูุณุฌูุงุช ุบูุฑ ุงููุทุงุจูุฉ
- ุงููุฑุงุฌุน ุงููุญุงููุฉ

**Sheet 4: Notes**
- ุงูุฅุนุฏุงุฏุงุช ุงููุณุชุฎุฏูุฉ
- ุงูุงูุชุฑุงุถุงุช
- ุงูููุงุญุธุงุช

### 3๏ธโฃ ุชูุฑูุฑ ุงูุญุงูุงุช ุงููุนุฑููุฉ

**Sheet 1: Validation_Results**
- ูู ุญุงูุฉ ูู ุงูู 28 ุญุงูุฉ
- ุญุงูุฉ ุงูุงูุชุดุงู (โ ููุชุดู / โ ููููุฏ)

**Sheet 2: Summary**
- ูุณุจุฉ ุงูุงูุชุดุงู ุงูุฅุฌูุงููุฉ
- ุนุฏุฏ ุงูุญุงูุงุช ุงูููุชุดูุฉ/ุงูููููุฏุฉ

---

## ๐ง ุงูุชุฎุตูุต

### ุชุนุฏูู ุงูููุชุงุญ ุงููุฑูุจ

ุงูุชุญ `run_enhanced_audit.py`:

```python
# ูู ุฏุงูุฉ detect_duplicates_enhanced()
required_fields = [
    'Season',          # ุฃุถู/ุงุญุฐู ุญุณุจ ุงูุญุงุฌุฉ
    'Race',
    'OwnerNumber',
    'OwnerName',
    'OwnerQatariID',
    'AwardAmount'
]
```

### ุชุนุฏูู ุฅุนุฏุงุฏุงุช ุงููุทุงุจูุฉ

```python
bank_matcher = EnhancedBankMatcher(
    ref_last_digits=10,      # ุขุฎุฑ N ุฃุฑูุงู (8-12 ูุซูุงู)
    amount_tolerance=0.00,   # ุงูุชุณุงูุญ (0.00 = ุชุทุงุจู ุชุงู)
    date_window_days=14      # ูุงูุฐุฉ ุงูุชุงุฑูุฎ (ยฑุฃูุงู)
)
```

### ุฅุถุงูุฉ ุญุงูุงุช Ground Truth

ุงูุชุญ `core/enhanced_audit_system.py`:

```python
class GroundTruthValidator:
    KNOWN_DUPLICATE_PAIRS = [
        # ... ุงูุญุงูุงุช ุงูููุฌูุฏุฉ
        ('NEW_REF1', 'NEW_REF2'),  # ุญุงูุฉ ุฌุฏูุฏุฉ
    ]
```

---

## ๐ก ุฃูุซูุฉ ุงูุงุณุชุฎุฏุงู ุนูู ุจูุงูุงุช ุฃุฎุฑู

### ูุซุงู 1: ุจูุงูุงุช ููุงุฑุฏ ุจุดุฑูุฉ (HR)

```python
from core.enhanced_audit_system import DataNormalizer

# 1. ุชูุญูุฏ
normalizer = DataNormalizer()
normalizer.COLUMN_MAPPING.update({
    'Employee ID': 'EmployeeID',
    'Salary': 'Amount',
})

hr_df = pd.read_excel('hr_data.xlsx')
hr_norm = normalizer.normalize_dataframe(hr_df, "HR")

# 2. ูุดู ุงูุชูุฑุงุฑุงุช
hr_norm['_Key'] = (
    hr_norm['EmployeeID'] + '|' +
    hr_norm['Month'] + '|' +
    hr_norm['Amount'].astype(str)
)

hr_norm['_Count'] = hr_norm.groupby('_Key')['_Key'].transform('count')
duplicates = hr_norm[hr_norm['_Count'] >= 2]

print(f"ุชูุฑุงุฑุงุช: {len(duplicates)}")
```

### ูุซุงู 2: ููุงุชูุฑ ูุงููุฉ

```python
from core.enhanced_audit_system import EnhancedBankMatcher

# 1. ุชุญููู
invoices = pd.read_excel('invoices.xlsx')
payments = pd.read_csv('bank_payments.csv')

# 2. ูุทุงุจูุฉ
matcher = EnhancedBankMatcher(amount_tolerance=0.00)
results = matcher.match_awards_to_bank(invoices, payments)

print(f"ูุทุงุจู: {len(results['matched'])}")
```

---

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### โ "ูู ูุชู ุงูุนุซูุฑ ุนูู ูููุงุช ุฌูุงุฆุฒ"

**ุงูุญู:**
```powershell
# ุชุญูู ูู ุงููุฌูุฏ
ls uploads/

# ูุฌุจ ูุฌูุฏ ุฃุญุฏ:
# - Combined_Awards_2018_2025.xlsx
# - Awards*.xlsx
```

### โ "ุงูุฃุฑูุงู ุงููุทุฑูุฉ ุจุตูุบุฉ ุนูููุฉ"

**ุงูุญู:** ุงููุธุงู ูุญูู ุชููุงุฆูุงู. ุฅุฐุง ุงุณุชูุฑุช ุงููุดููุฉ:
1. ุงูุชุญ Excel
2. ุบููุฑ ุชูุณูู ุงูุนููุฏ ุฅูู **ูุต**
3. ุงุญูุธ

### โ๏ธ "ูุณุจุฉ ุงูุชุดุงู ููุฎูุถุฉ ููุญุงูุงุช ุงููุนุฑููุฉ"

**ุงูุฃุณุจุงุจ:**
- ุงูุจูุงูุงุช ูุง ุชุญุชูู ุนูู ุฌููุน ุงูููุงุณู
- ุจุนุถ ุงููุฑุงุฌุน ูุญุฐููุฉ
- ุงุฎุชูุงู ูู ุฃุณูุงุก ุงูุฃุนูุฏุฉ

**ุงูุญู:**
```python
# ูุญุต ุงููุฑุงุฌุน
ref = '821B291050'
found = duplicates[
    duplicates['PaymentReference'].str.contains(ref, na=False)
]
print(f"ููุฌุฏ: {len(found)}")
```

---

## ๐ ุงููุซุงุฆู

| ุงูููู | ุงููุตู |
|-------|-------|
| `PROMPT_ANALYSIS_AND_IMPROVEMENTS.md` | ุงูุชุญููู ุงูุดุงูู ููุจุฑูุจุช |
| `ENHANCED_SYSTEM_GUIDE.md` | ุฏููู ุงูุงุณุชุฎุฏุงู ุงููุงูู |
| `core/enhanced_audit_system.py` | ุงูููุชุจุฉ ุงูุฑุฆูุณูุฉ |
| `run_enhanced_audit.py` | ุงูุจุฑูุงูุฌ ุงูุฑุฆูุณู |
| `test_enhanced_system.py` | ุงูุงุฎุชุจุงุฑุงุช |

---

## โ ูุงุฆูุฉ ุงูุชุญูู ูุจู ุงูุฅูุชุงุฌ

- [ ] ุฌููุน ุงููููุงุช ูู `uploads/`
- [ ] ุงูููุชุงุญ ุงููุฑูุจ ุตุญูุญ (6 ุญููู)
- [ ] ุงูุฅุนุฏุงุฏุงุช ูุถุจูุทุฉ (tolerance, window, digits)
- [ ] ุงูุญุงูุงุช ุงููุนุฑููุฉ ูุญุฏุซุฉ
- [ ] ุชุดุบูู ุชุฌุฑูุจู ูุงุฌุญ: `python test_enhanced_system.py`

---

## ๐ ุงูุฎูุงุตุฉ

### ูุง ูููุฒ ูุฐุง ุงููุธุงู:

1. โ **ูุชูุงูู 100%** ูุน ุงูุจุฑูุจุช ุงูุงุญุชุฑุงูู
2. โ **ุฏูุฉ ุนุงููุฉ** ูู ูุดู ุงูุชูุฑุงุฑุงุช
3. โ **ูุทุงุจูุฉ ุจูููุฉ ุฐููุฉ** (3 ูุฆุงุช)
4. โ **ููุซูู** ููุฌูุงุช ุงูุชุฏููููุฉ
5. โ **ูุงุจู ูุฅุนุงุฏุฉ ุงูุงุณุชุฎุฏุงู** ุนูู ุฃู ุจูุงูุงุช
6. โ **ููุซูู ุจุงููุงูู** - ูู ุนูููุฉ ููุซูุฉ

### ุงูุงุณุชุฎุฏุงู ุงููุณุชูุจูู:

ูููู ุชุทุจูู ููุณ ุงููููุฌูุฉ ุนูู:
- โ ุจูุงูุงุช ููุงุฑุฏ ุจุดุฑูุฉ
- โ ููุงุชูุฑ ูุงููุฉ
- โ ูุตุฑููุงุช ุญููููุฉ
- โ ุฃู ุจูุงูุงุช ุชุญุชุงุฌ ูุดู ุชูุฑุงุฑ

---

## ๐จโ๐ป ุงูุชุทููุฑ

ุชู ุงูุชุทููุฑ ุจูุงุกู ุนูู:
- ๐ ุชุญููู ุงุญุชุฑุงูู ุดุงูู ููุจุฑูุจุช
- ๐ ููู ุนููู ููุชุทูุจุงุช ุงูุชุฏููู
- ๐ก ุฃูุถู ุงูููุงุฑุณุงุช ูู ููุฏุณุฉ ุงูุจุฑูุฌูุงุช
- โจ ุงูุชุฑููุฒ ุนูู ูุงุจููุฉ ุฅุนุงุฏุฉ ุงูุงุณุชุฎุฏุงู

**ุงูุชุงุฑูุฎ:** ููููุจุฑ 2025

**ุงูุฅุตุฏุงุฑ:** 2.0 (Enhanced)

---

## ๐ง ุงูุฏุนู

ููุฃุณุฆูุฉ ูุงูุฏุนูุ ุฑุงุฌุน:
- `ENHANCED_SYSTEM_GUIDE.md` - ุฏููู ุดุงูู
- `PROMPT_ANALYSIS_AND_IMPROVEMENTS.md` - ุชูุงุตูู ุชูููุฉ

---

**๐ ุฌุงูุฒ ููุงุณุชุฎุฏุงู ุงูุงุญุชุฑุงูู!**
